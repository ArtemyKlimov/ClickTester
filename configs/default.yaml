# ClickHouse Table Structure Tester — пример конфигурации
# Референс: Create_db_v11.sql (logs_db.app_logs_v10), benchmark-dso-config/application-new.yml

clickhouse:
  host: localhost
  port: 9000
  database: logs_db
  user: user
  password: password
  table_name: app_logs_v10
  secure: false

test_params:
  projectCode: "AXDP"
  appName: "axdp-client-api"
  namespace: "dk5-axdp01-axdp-dev1-1"
  level: "INFO"
  text_token: "error"

execution:
  workers: 4
  query_timeout_sec: 60

report:
  output_path: reports/report.html
  thresholds:
    granules_warn: 500
    granules_fail: 2000
    read_rows_warn: 1000000

structure_checks:
  - name: partitions
    type: partitions
    description: "Проверка наличия и списка партиций таблицы (system.parts)."
  - name: skipping_indexes
    type: indexes
    description: "Проверка data skipping индексов (bloom_filter, tokenbf_v1)."
  - name: projections
    type: projections
    description: "Проверка наличия проекций (counter_with_dims и др.)."
  - name: granularity_settings
    type: granules_settings
    description: "Проверка настроек гранул (SHOW CREATE TABLE)."

query_templates:
  # --- 15 MINUTE, SELECT LIMIT 500 ---
  - name: q_15m_project
    description: "Выборка по проекту за 15 мин, ORDER BY mainTimestampTime, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_15m_project_app
    description: "Проект + приложение, 15 мин, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_15m_project_ns
    description: "Проект + namespace, 15 мин, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND namespace = '$namespace$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_15m_project_ns_app
    description: "Проект + namespace + приложение, 15 мин, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_15m_project_level_token
    description: "Проект + level + hasToken(text/stack), 15 мин, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND level = '$level$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_15m_project_level_ns_app_token
    description: "Проект + level + namespace + app + token, 15 мин, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true

  # --- 1 HOUR, SELECT LIMIT 500 ---
  - name: q_1h_project
    description: "Выборка по проекту за 1 час, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1h_project_app
    description: "Проект + приложение, 1 час, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1h_project_ns
    description: "Проект + namespace, 1 час, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND namespace = '$namespace$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1h_project_ns_app
    description: "Проект + namespace + приложение, 1 час, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1h_project_level_token
    description: "Проект + level + token по text/stack, 1 час, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND level = '$level$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1h_project_level_ns_app_token
    description: "Проект + level + namespace + app + token, 1 час, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true

  # --- 1 DAY, SELECT LIMIT 500 ---
  - name: q_1d_project
    description: "Выборка по проекту за 1 день, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1d_project_app
    description: "Проект + приложение, 1 день, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1d_project_ns
    description: "Проект + namespace, 1 день, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1d_project_ns_app
    description: "Проект + namespace + приложение, 1 день, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1d_project_level_token
    description: "Проект + level + token, 1 день, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_1d_project_level_ns_app_token
    description: "Проект + level + namespace + app + token, 1 день, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true

  # --- 4 DAY, SELECT LIMIT 500 ---
  - name: q_4d_project
    description: "Выборка по проекту за 4 дня, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_4d_project_app
    description: "Проект + приложение, 4 дня, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_4d_project_ns
    description: "Проект + namespace, 4 дня, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_4d_project_ns_app
    description: "Проект + namespace + приложение, 4 дня, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_4d_project_level_token
    description: "Проект + level + token, 4 дня, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true
  - name: q_4d_project_level_ns_app_token
    description: "Проект + level + namespace + app + token, 4 дня, LIMIT 500."
    query: "SELECT * FROM (SELECT * FROM $table_name$ WHERE mainTimestampTime >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' AND (hasToken(lower(text),lower('$text_token$')) OR hasToken(lower(stack),lower('$text_token$'))) ORDER BY mainTimestampTime DESC LIMIT 500) ORDER BY localTime DESC"
    collect_explain: true
    collect_stats: true

  # --- Агрегации: 15 MINUTE, интервал 1 MINUTE ---
  - name: agg_1m_15m_project
    description: "Агрегация по 1 мин, проект, последние 15 мин."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 1 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_1m_15m_project_app
    description: "Агрегация 1 мин, проект + приложение, 15 мин."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 1 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_1m_15m_project_ns
    description: "Агрегация 1 мин, проект + namespace, 15 мин."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 1 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND namespace = '$namespace$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_1m_15m_project_ns_app
    description: "Агрегация 1 мин, проект + namespace + app, 15 мин."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 1 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_1m_15m_project_level_app
    description: "Агрегация 1 мин, проект + level + app, 15 мин."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 1 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND level = '$level$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_1m_15m_project_level_ns_app
    description: "Агрегация 1 мин, проект + level + namespace + app, 15 мин."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 1 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 15 MINUTE AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true

  # --- Агрегации: 1 HOUR, интервал 5 MINUTE ---
  - name: agg_5m_1h_project
    description: "Агрегация по 5 мин, проект, последний 1 час."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 5 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_5m_1h_project_app
    description: "Агрегация 5 мин, проект + приложение, 1 час."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 5 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_5m_1h_project_ns
    description: "Агрегация 5 мин, проект + namespace, 1 час."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 5 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND namespace = '$namespace$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_5m_1h_project_ns_app
    description: "Агрегация 5 мин, проект + namespace + app, 1 час."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 5 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_5m_1h_project_level_app
    description: "Агрегация 5 мин, проект + level + app, 1 час."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 5 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND level = '$level$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_5m_1h_project_level_ns_app
    description: "Агрегация 5 мин, проект + level + namespace + app, 1 час."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 5 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 HOUR AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true

  # --- Агрегации: 1 DAY и 4 DAY, интервал 30 MINUTE ---
  - name: agg_30m_1d_project
    description: "Агрегация по 30 мин, проект, последний 1 день."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_1d_project_app
    description: "Агрегация 30 мин, проект + приложение, 1 день."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_1d_project_ns
    description: "Агрегация 30 мин, проект + namespace, 1 день."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_1d_project_ns_app
    description: "Агрегация 30 мин, проект + namespace + app, 1 день."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_1d_project_level_app
    description: "Агрегация 30 мин, проект + level + app, 1 день."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_1d_project_level_ns_app
    description: "Агрегация 30 мин, проект + level + namespace + app, 1 день."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 1 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true

  - name: agg_30m_4d_project
    description: "Агрегация по 30 мин, проект, последние 4 дня."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_4d_project_app
    description: "Агрегация 30 мин, проект + приложение, 4 дня."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_4d_project_ns
    description: "Агрегация 30 мин, проект + namespace, 4 дня."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_4d_project_ns_app
    description: "Агрегация 30 мин, проект + namespace + app, 4 дня."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_4d_project_level_app
    description: "Агрегация 30 мин, проект + level + app, 4 дня."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
  - name: agg_30m_4d_project_level_ns_app
    description: "Агрегация 30 мин, проект + level + namespace + app, 4 дня."
    query: "SELECT toStartOfInterval(toStartOfMinute(localTime), INTERVAL 30 MINUTE) AS t, count() FROM $table_name$ WHERE toStartOfMinute(mainTimestampTime) >= now() - INTERVAL 4 DAY AND projectCode = '$projectCode$' AND level = '$level$' AND namespace = '$namespace$' AND appName = '$appName$' GROUP BY t ORDER BY t"
    collect_explain: true
    collect_stats: true
